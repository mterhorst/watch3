<!DOCTYPE html>
<html>
<body>
    <button onclick="register()">Register</button>
    <button onclick="startStream()">Start stream</button>

    <script>
        let subscription = null;

        async function init() {

            const publicVapidKey = 'BDw80NGaMAXMvqrXXPTXyQogKoZ_hFaUTyyi9WG6NCBX9vsZ8RvHICIfs5IBuO_DeeTNDQQlyKQyw_MgI1rs5eI';

            const registration = await navigator.serviceWorker.register('service-worker.js');
            subscription = await registration.pushManager.subscribe({
                userVisibleOnly: true,
                applicationServerKey: publicVapidKey
            });

            //registration.active.postMessage({ type: 'SET_SUBSCRIPTION', subscription: subscription.toJSON() });


        }

        async function register() {



            await fetch('api/register_subscription', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(subscription.toJSON())
            });
        }

        async function startStream() {
            await fetch('/control/push', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    type: 0,
                    body: {}
                })
            });
        }

        init();
    </script>
</body>
</html>